{"version":3,"sources":["components/games/parts/Scoreboard.js","static/css/score.module.css","components/games/parts/Alert.js","static/css/alert.module.css","static/css/canvas.module.css","components/games/parts/CanvasTools.js","components/games/Tictactoe.js"],"names":["Scoreboard","props","getPlayersList","sortedPlayersArray","undefined","queue","numberInQueue","push","players","Array","prototype","apply","map","player","index","style","color","connected","playerNumber","userId","userName","score","prop","state","timeleft","timeTurn","lasttime","Date","now","playerTurnTimer","this","displayCurrentPlayer","setInterval","paused","newTimeleft","setState","clearInterval","scoreColor","className","styles","scoreItemNames","itemName","scoreCurrentPlayer","top","currentPlayerTurn","backgroundColor","React","Component","module","exports","Alert","shouldComponentUpdate","nextProps","value","alertDisplay","alertTimeoutDestroy","clearTimeout","setTimeout","forceUpdate","alertHide","alert","onClick","animate","animRenderF","time","animStart","window","requestAnimationFrame","animStep","timestamp","animCurrentTime","Tictactoe","displayPoint","x","y","animation","ctx","canvas","current","getContext","lineCap","lineWidth","currentBoard","gameInfo","boardSize","clearRect","fillStyle","fillRect","fill","strokeStyle","beginPath","coordFirstLine","Math","floor","moveTo","lineTo","coordSecondLine","stroke","arc","PI","clear","i","actionTurn","e","alertValue","rect","getBoundingClientRect","clientX","left","clientY","hasOwnProperty","emitter","emit","every","localStorage","getItem","queuePlayer","queueIndex","createRef","emitterUnsubGame","sub","data","type","cell","newScore","prevState","nextPlayer","cellNumber","ref","width","height"],"mappings":"oOAcqBA,E,kDACnB,WAAYC,GAAQ,IAAD,8BACjB,cAAMA,IAkBRC,eAAiB,WACf,IAAMC,EAAqB,GAC3B,QAAuBC,IAAnB,EAAKH,MAAMI,MAAkB,CAAC,IAAD,gBACL,EAAKJ,MAAMI,OADN,IAC/B,2BAA4C,CAAC,IAApCC,EAAmC,QAC1CH,EAAmBI,KAAK,EAAKN,MAAMO,QAAQF,KAFd,oCAI1BG,MAAMC,UAAUH,KAAKI,MAAMR,EAAmB,EAAKF,MAAMO,SAEhE,OAAOL,EAAmBS,KAAI,SAACC,EAAQC,GAAT,OAC9B,sBAAKC,MAAO,CAACC,MAAQH,EAAOI,UAA6B,EAAKhB,MAAMiB,eAAeJ,EAAM,iBAAiB,OAApE,oBAAtC,UACE,gCACE,8BAAMA,EAAM,IACZ,oCAAOD,EAAOM,UACd,8BAAMN,EAAOO,cAEd,EAAKnB,MAAMoB,MAAMP,GAAOF,KAAI,SAAAU,GAAI,OACjC,8BAAMA,cAjCR,EAAKC,MAAQ,CACXC,aAAcvB,EAAMwB,SAAWxB,EAAMyB,SAAWC,KAAKC,OAAO,MAE9D,EAAKC,qBAAkBzB,EALN,E,gEAOE,IAAD,OAEd0B,KAAK7B,MAAM8B,uBAAsBD,KAAKD,gBAAkBG,aAAY,WACtE,IAAK,EAAKC,OAAQ,CAChB,IAAMC,MAAkB,EAAKjC,MAAMwB,SAAW,EAAKxB,MAAMyB,SAAWC,KAAKC,OAAO,KAChF,EAAKO,SAAS,CAACX,SAAUU,OAE1B,Q,6CAGCJ,KAAK7B,MAAM8B,sBAAsBK,cAAcN,KAAKD,mB,+BAwBxD,IAAMQ,EAAU,cAAU,IAAMP,KAAKP,MAAMC,UAAUM,KAAK7B,MAAMwB,SAAS,KAAM,IAA/D,aAAuEK,KAAKP,MAAMC,UAAUM,KAAK7B,MAAMwB,SAAS,KAAM,IAAtH,QACd,OACQ,sBAAKa,UAAWC,IAAOlB,MAAvB,UACE,gCACE,uEACCS,KAAK7B,MAAMuC,eAAe5B,KAAI,SAAA6B,GAAQ,OACrC,8BAAMA,UAGTX,KAAK7B,MAAM8B,qBACZ,sBAAKO,UAAWC,IAAOG,mBAAoB3B,MAAO,CAACC,MAAOqB,EAAYM,IAAK,GAAkC,GAA7Bb,KAAK7B,MAAM2C,kBAAqB,KAAMC,gBAAiBR,GAAvI,UACE,8BAAMP,KAAKP,MAAMC,WACjB,qBAAKT,MAAO,CAAC,eAAgBsB,KAC7B,qBAAKtB,MAAO,CAAC,eAAgBsB,QAE9B,wBAGAP,KAAK5B,wB,GA5DkB4C,IAAMC,Y,mBCb9CC,EAAOC,QAAU,CAAC,MAAQ,qBAAqB,mBAAqB,oC,2ICE/CC,E,kDACnB,WAAYjD,GAAQ,IAAD,8BACjB,cAAMA,IAIRkD,sBAAwB,SAACC,GACvB,OAAIA,EAAUC,QAAQ,EAAKpD,MAAMoD,QACjC,EAAKC,cAAe,OACWlD,IAA3B,EAAKmD,qBACPC,aAAa,EAAKD,qBAEpB,EAAKA,oBAAsBE,YAAW,WACpC,EAAKH,cAAe,EACpB,EAAKC,yBAAsBnD,EAC3B,EAAKsD,gBACJ,MACI,IAhBU,EAkBnBC,UAAY,WACVH,aAAa,EAAKD,qBAClB,EAAKD,cAAe,EACpB,EAAKC,yBAAsBnD,EAC3B,EAAKsD,eApBL,EAAKJ,cAAe,EACpB,EAAKC,yBAAsBnD,EAHV,E,qDAyBjB,OACE,qBAAKkC,UAAS,UAAKC,IAAOqB,MAAZ,YAAqB9B,KAAKwB,aAAaf,IAAOe,aAAa,IAAzE,SACE,qBAAKO,QAAS/B,KAAK6B,UAAnB,SACG7B,KAAK7B,MAAMoD,c,GA7BaP,IAAMC,Y,mBCFzCC,EAAOC,QAAU,CAAC,MAAQ,qBAAqB,aAAe,8B,mBCA9DD,EAAOC,QAAU,CAAC,OAAS,yB,8JCD3B,SAASa,EAAQC,EAAaC,GAC5B,IAAIC,EAAY,KAOhBC,OAAOC,uBANU,SAAXC,EAAWC,GACVJ,IAAWA,EAAUI,GAC1B,IAAMC,EAAkBD,EAAYJ,EACpCF,EAAYO,GACRA,EAAgBN,GAAME,OAAOC,sBAAsBC,M,qBCCtCG,E,kDACnB,WAAYtE,GAAQ,IAAD,8BACjB,cAAMA,IAqERuE,aAAe,SAACnB,EAAOoB,EAAGC,GAAwB,IAArBC,EAAoB,wDACzCC,EAAM,EAAKC,OAAOC,QAAQC,WAAW,MAI3C,GAHAH,EAAII,QAAU,QACdJ,EAAIK,UAAY,EAChB,EAAKC,aAAa,EAAKjF,MAAMkF,SAASC,UAAUV,EAAID,GAAKpB,GACzC,IAAZsB,EACF,OAAQtB,GACN,KAAK,EACHS,GAAQ,SAAAO,GACNO,EAAIS,UAAY,GAAFZ,EAAK,EAAK,GAAFC,EAAK,EAAG,GAAI,IAClCE,EAAIU,UAAJ,4BAAqCjB,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAAK,GAAGA,EAAU,KAAM,IAAK,EAA1G,KACAO,EAAIW,SAAW,GAAFd,EAAK,EAAK,GAAFC,EAAK,EAAG,GAAI,IACjCE,EAAIY,OACJZ,EAAIa,YAAc,OAClBb,EAAIc,YACJ,IAAMC,EAAiBC,KAAKC,OAAOxB,EAAU,IAAIA,EAAU,KAAK,IAGhE,GAFAO,EAAIkB,OAAS,GAAFrB,EAAK,EAAK,GAAFC,EAAK,GACxBE,EAAImB,OAAS,GAAFtB,EAAK,EAAEkB,EAAkB,GAAFjB,EAAK,EAAEiB,GACrCtB,EAAU,IAAK,CACjB,IAAM2B,EAAkBJ,KAAKC,OAAOxB,EAAU,IAAIA,EAAU,IAAI,KAAK,IACrEO,EAAIkB,OAAS,GAAFrB,EAAK,GAAM,GAAFC,EAAK,GACzBE,EAAImB,OAAS,GAAFtB,EAAK,GAAGuB,EAAmB,GAAFtB,EAAK,EAAEsB,GAE7CpB,EAAIqB,WACH,KACL,MACA,KAAK,EACHnC,GAAQ,SAAAO,GACNO,EAAIS,UAAY,GAAFZ,EAAK,EAAK,GAAFC,EAAK,EAAG,GAAI,IAClCE,EAAIU,UAAJ,4BAAqCjB,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAAK,GAAGA,EAAU,KAAM,IAAK,EAA1G,KACAO,EAAIW,SAAW,GAAFd,EAAK,EAAK,GAAFC,EAAK,EAAG,GAAI,IACjCE,EAAIY,OACJZ,EAAIa,YAAc,MAClBb,EAAIc,YACJd,EAAIsB,IAAM,GAAFzB,EAAK,GAAM,GAAFC,EAAK,GAAI,EAAG,GAAGkB,KAAKO,IAAI9B,EAAU,IAAIA,EAAU,IAAI,IAAI,GACzEO,EAAIqB,WACH,KACL,MACA,KAAK,EACHnC,GAAQ,SAAAO,GACNO,EAAIS,UAAY,GAAFZ,EAAK,EAAK,GAAFC,EAAK,EAAG,GAAI,IAClCE,EAAIU,UAAJ,4BAAqCjB,EAAU,IAAKA,EAAU,IAAKA,EAAU,IAAK,GAAGA,EAAU,KAAM,IAAK,EAA1G,KACAO,EAAIW,SAAW,GAAFd,EAAK,EAAK,GAAFC,EAAK,EAAG,GAAI,IACjCE,EAAIY,OACJZ,EAAIU,UAAY,QAChBV,EAAIc,YACJd,EAAIsB,IAAM,GAAFzB,EAAK,GAAM,GAAFC,EAAK,GAAIL,EAAU,IAAIA,EAAU,GAAG,EAAG,EAAW,EAARuB,KAAKO,IAAM,GACtEvB,EAAIY,SACH,UAKP,OAAQnC,GACN,KAAK,EACHuB,EAAIa,YAAc,OAClBb,EAAIc,YACJd,EAAIkB,OAAS,GAAFrB,EAAK,EAAK,GAAFC,EAAK,GACxBE,EAAImB,OAAS,GAAFtB,EAAK,GAAM,GAAFC,EAAK,IACzBE,EAAIkB,OAAS,GAAFrB,EAAK,GAAM,GAAFC,EAAK,GACzBE,EAAImB,OAAS,GAAFtB,EAAK,EAAK,GAAFC,EAAK,IACxBE,EAAIqB,SACN,MACA,KAAK,EACHrB,EAAIa,YAAc,MAClBb,EAAIc,YACJd,EAAIsB,IAAM,GAAFzB,EAAK,GAAM,GAAFC,EAAK,GAAI,EAAG,EAAa,EAAVkB,KAAKO,IAAQ,GAC7CvB,EAAIqB,SACN,MACA,KAAK,EACHrB,EAAIU,UAAY,QAChBV,EAAIc,YACJd,EAAIsB,IAAM,GAAFzB,EAAK,GAAM,GAAFC,EAAK,GAAI,EAAG,EAAa,EAAVkB,KAAKO,IAAQ,GAC7CvB,EAAIY,SA/IO,EAqJnBY,MAAQ,WACN,IAAMxB,EAAM,EAAKC,OAAOC,QAAQC,WAAW,MAC3CH,EAAIS,UAAU,EAAE,EAAoC,IAAjC,EAAKpF,MAAMkF,SAASC,UAAU,GAAyC,IAAjC,EAAKnF,MAAMkF,SAASC,UAAU,IACvFR,EAAIa,YAAc,OAClBb,EAAIK,UAAY,EAChBL,EAAIc,YACJ,IAAI,IAAIW,EAAI,EAAGA,GAAK,EAAKpG,MAAMkF,SAASC,UAAWiB,IACjDzB,EAAIkB,OAAS,GAAFO,EAAM,GACjBzB,EAAImB,OAAS,GAAFM,EAAoC,GAA9B,EAAKpG,MAAMkF,SAASC,WAEvC,IAAI,IAAIiB,EAAI,EAAGA,GAAK,EAAKpG,MAAMkF,SAASC,UAAWiB,IACjDzB,EAAIkB,OAAO,EAAK,GAAFO,GACdzB,EAAImB,OAAqC,GAA9B,EAAK9F,MAAMkF,SAASC,UAAgB,GAAFiB,GAE/CzB,EAAIqB,UAnKa,EAsKnBK,WAAa,SAACC,GACZ,GAAI,EAAKtE,QAAQ,EAAKf,eAAe,EAAKK,MAAMqB,kBAAmB,OAAO,EAAKT,SAAS,CAACqE,WAAY,2IACrG,IAAMC,EAAO,EAAK5B,OAAOC,QAAQ4B,wBAC3BjC,MAAQ8B,EAAEI,QAAUF,EAAKG,MAAM,IAC/BlC,MAAQ6B,EAAEM,QAAUJ,EAAK9D,KAAK,IAC/B,EAAKuC,aAAa4B,eAAepC,GAAG,EAAKzE,MAAMkF,SAASC,UAAUX,GAEhE,EAAKtC,SAAS,CAACqE,WAAY,8EADhC,EAAKvG,MAAM8G,QAAQC,KAAK,SAAU,CAACvC,EAAGA,EAAGC,EAAGA,KA1K9C,EAAKnD,MAAQ,CACdqB,kBAAmB3C,EAAMkF,SAASvC,kBAC/BvB,MAAOpB,EAAMkF,SAAS9D,MACtBmF,WAAY,GACZ9E,SAAUzB,EAAMkF,SAASzD,UAE3B,EAAKwD,aAAejF,EAAMkF,SAASD,aACnC,EAAKjD,OAAShC,EAAMkF,SAASlD,OAC7BhC,EAAMO,QAAQyG,OAAM,SAACpG,EAAQC,GAAT,OAAmBD,EAAOM,UAAW+F,aAAaC,QAAQ,WAAelH,EAAMkF,SAAS9E,MAAM4G,OAAM,SAACG,EAAaC,GAClI,OAAID,IAActG,IAClB,EAAKI,aAAemG,GACb,SAGX,EAAKxC,OAAS/B,IAAMwE,YAhBH,E,iEAkBG,IAAD,OACnBxF,KAAKyF,iBAAmBzF,KAAK7B,MAAM8G,QAAQS,IAAI,QAAQ,SAAAC,GACrD,OAAOA,EAAKC,MACV,IAAK,eACH,EAAKvF,SAAS,CACZS,kBAAmB6E,EAAK7E,kBACxBlB,SAAU+F,EAAK/F,SACf8E,WAAW,0HAAD,OAA6B,EAAKvG,MAAMO,QAAQ,EAAKP,MAAMkF,SAAS9E,MAAMoH,EAAK7E,oBAAoBxB,SAAnG,OAEZ,EAAKa,QAAS,EACd,EAAKiD,aAAe,GACpB,EAAKkB,QACL,MACF,IAAK,gBACH,EAAKnE,QAAS,EACd,EAAKuC,aAAaiD,EAAKE,KAAMF,EAAKhD,EAAGgD,EAAK/C,GAAG,GAC7C,IAAMkD,EAAW,EAAKrG,MAAMF,MAAMoG,EAAKE,MAAM,KAC7C,EAAKxF,UAAS,SAAC0F,GAAD,MAAgB,CAC5BjF,kBAAmB6E,EAAKK,WACxBzG,MAAM,2BAAKwG,EAAUxG,OAAUuG,GAC/BlG,SAAU+F,EAAK/F,SACf8E,WAAW,+HAAD,OAA6B,EAAKvG,MAAMO,QAAQ,EAAKP,MAAMkF,SAAS9E,MAAMoH,EAAKE,OAAOvG,cAClG,MACF,IAAK,OACH,EAAKe,SAAS,CAACS,kBAAmB6E,EAAKK,WAAYpG,SAAU+F,EAAK/F,SAAU8E,WAAW,2DAAD,OAAgB,EAAKvG,MAAMO,QAAQ,EAAKP,MAAMkF,SAAS9E,MAAMoH,EAAKK,aAAa1G,YACrK,EAAKoD,aAAaiD,EAAKE,KAAMF,EAAKhD,EAAGgD,EAAK/C,GAAG,GAC7C,MACF,IAAK,QACH,EAAKF,aAAaiD,EAAKE,KAAMF,EAAKhD,EAAGgD,EAAK/C,GAC1C,MACF,IAAK,gBACH,EAAKvC,SAAS,CAACqE,WAAW,yHAAD,OAA4B,EAAKvG,MAAMO,QAAQ,EAAKP,MAAMkF,SAAS9E,MAAMoH,EAAK7E,oBAAoBxB,YAC3H,MACF,IAAK,aACC,EAAKG,MAAMqB,oBAAoB,EAAK1B,aAAc,EAAKiB,SAAS,CAACqE,WAAY,iGAC5E,EAAKrE,SAAS,CAACqE,WAAY,+HAChC,EAAKrE,SAAS,CAACS,kBAAmB6E,EAAKK,WAAYpG,SAAU+F,EAAK/F,iB,0CAQtE,IAAK,IAAIqG,KADTjG,KAAKsE,QACkBtE,KAAKoD,aAC1BpD,KAAK0C,aAAa1C,KAAKoD,aAAa6C,GAAaA,EAAWjG,KAAK7B,MAAMkF,SAASC,aAAc2C,EAAWjG,KAAK7B,MAAMkF,SAASC,c,6CAIjItD,KAAKyF,qB,+BA6GH,OACM,qCACE,cAACvH,EAAA,EAAD,CAAY+B,sBAAsB,EAChCE,OAAQH,KAAKG,OACb5B,MAAOyB,KAAK7B,MAAMkF,SAAS9E,MAC3BG,QAASsB,KAAK7B,MAAMO,QACpBoC,kBAAmBd,KAAKP,MAAMqB,kBAC9B1B,aAAcY,KAAKZ,aACnBO,SAAUK,KAAK7B,MAAMkF,SAAS1D,SAC9BC,SAAUI,KAAKP,MAAMG,SACrBL,MAAOS,KAAKP,MAAMF,MAClBmB,eAAgB,CAAC,8BAEnB,cAACU,EAAA,EAAD,CAAOG,MAAOvB,KAAKP,MAAMiF,aAEzB,qBAAKlE,UAAWC,IAAOsC,OAAvB,SACE,wBAAQmD,IAAKlG,KAAK+C,OAAQhB,QAAS/B,KAAKwE,WAAY2B,MAAwC,IAA/BnG,KAAK7B,MAAMkF,SAASC,UAAc,EAAG8C,OAAyC,IAA/BpG,KAAK7B,MAAMkF,SAASC,UAAc,a,GAjMvHtC,IAAMC","file":"static/js/6.5021a205.chunk.js","sourcesContent":["import React from 'react'\r\nimport styles from '../../../static/css/score.module.css'\r\n/*\r\n  displayCurrentPlayer - Выделить текущего игрока\r\n  paused - Останавливает/Включает таймер\r\n  queue - Последовательность игроков к которым применяется\r\n  players - Массив игроков ex: [{\"userId\":\"11\", \"userName\": \"eeee\r\n  currentPlayerTurn - Текщий игрок\r\n  playerNumber - Игрок (не ставить если гость)\r\n  timeTurn - Время на совершение хода \r\n  lasttime - Время начала хода ()\r\n  score - Счёт ex: [[0,0,0], [1,0,0]]\r\n  scoreItemNames - Названия столбцов ex: ['Счёт', 'Осталось', 'Найдено']\r\n*/\r\nexport default class Scoreboard extends React.Component {\r\n  constructor(props) {\r\n    super(props) \r\n    this.state = {\r\n      timeleft: ~~((props.timeTurn + props.lasttime - Date.now())/1000),\r\n    }\r\n    this.playerTurnTimer = undefined\r\n  }\r\n  componentDidMount() {\r\n    //Отображение оставшегося времени у игрока\r\n    if (this.props.displayCurrentPlayer) this.playerTurnTimer = setInterval(() => {\r\n      if (!this.paused) {\r\n        const newTimeleft = ~~((this.props.timeTurn + this.props.lasttime - Date.now())/1000)\r\n        this.setState({timeleft: newTimeleft})\r\n      }\r\n    }, 1000)\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.props.displayCurrentPlayer) clearInterval(this.playerTurnTimer)\r\n  }\r\n  getPlayersList = () => {\r\n    const sortedPlayersArray = []\r\n    if (this.props.queue!==undefined){\r\n      for (let numberInQueue of this.props.queue) {\r\n        sortedPlayersArray.push(this.props.players[numberInQueue])\r\n      }\r\n    } else Array.prototype.push.apply(sortedPlayersArray,this.props.players)\r\n    \r\n    return sortedPlayersArray.map((player, index) => \r\n    <div style={{color: !player.connected?\"rgb(150,150,150)\":this.props.playerNumber===index?\"rgb(255,165,0)\":\"#000\"}}>\r\n      <div>\r\n        <div>{index+1}</div>\r\n        <div>#{player.userId}</div>\r\n        <div>{player.userName}</div>\r\n      </div>\r\n      {this.props.score[index].map(prop=>\r\n      <div>{prop}</div>\r\n      )}\r\n    </div>\r\n    )\r\n  }\r\n  render() {\r\n    const scoreColor = `rgb(${255 - this.state.timeleft/(this.props.timeTurn/1000)*255}, ${this.state.timeleft/(this.props.timeTurn/1000)*200}, 0)`\r\n      return (\r\n              <div className={styles.score}>\r\n                <div>\r\n                  <div>Игроки</div>\r\n                  {this.props.scoreItemNames.map(itemName=>\r\n                    <div>{itemName}</div>\r\n                    )}\r\n                </div>\r\n                {this.props.displayCurrentPlayer?\r\n                <div className={styles.scoreCurrentPlayer} style={{color: scoreColor, top: 25 + this.props.currentPlayerTurn*42+'px', backgroundColor: scoreColor}}>\r\n                  <div>{this.state.timeleft}</div>\r\n                  <div style={{\"border-color\": scoreColor}}></div>\r\n                  <div style={{\"border-color\": scoreColor}}></div>\r\n                </div>\r\n                :<div></div>\r\n                }\r\n                \r\n                {this.getPlayersList()}\r\n              </div>\r\n      )\r\n  }\r\n}","// extracted by mini-css-extract-plugin\nmodule.exports = {\"score\":\"score_score__1Slqo\",\"scoreCurrentPlayer\":\"score_scoreCurrentPlayer__36TAD\"};","import React from 'react'\r\nimport styles from '../../../static/css/alert.module.css'\r\n\r\nexport default class Alert extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.alertDisplay = false\r\n    this.alertTimeoutDestroy = undefined\r\n  }\r\n  shouldComponentUpdate = (nextProps) => {\r\n    if (nextProps.value===this.props.value) return false\r\n    this.alertDisplay = true\r\n    if (this.alertTimeoutDestroy!==undefined) {\r\n      clearTimeout(this.alertTimeoutDestroy)\r\n    }\r\n    this.alertTimeoutDestroy = setTimeout(() => {\r\n      this.alertDisplay = false\r\n      this.alertTimeoutDestroy = undefined\r\n      this.forceUpdate()\r\n    }, 3000)\r\n    return true\r\n  }\r\n  alertHide = () => {\r\n    clearTimeout(this.alertTimeoutDestroy)\r\n    this.alertDisplay = false\r\n    this.alertTimeoutDestroy = undefined\r\n    this.forceUpdate()\r\n  }\r\n  render() {\r\n    return (\r\n      <div className={`${styles.alert} ${this.alertDisplay?styles.alertDisplay:''}`}>\r\n        <div onClick={this.alertHide}>\r\n          {this.props.value}\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"alert\":\"alert_alert__285A5\",\"alertDisplay\":\"alert_alertDisplay__3muLT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvas\":\"canvas_canvas__1xjwk\"};","function animate(animRenderF, time) {\r\n  let animStart = null\r\n  const animStep = timestamp => {\r\n    if (!animStart) animStart=timestamp\r\n    const animCurrentTime = timestamp - animStart\r\n    animRenderF(animCurrentTime)\r\n    if (animCurrentTime<time) window.requestAnimationFrame(animStep)\r\n  }      \r\n  window.requestAnimationFrame(animStep)\r\n}\r\nexport {animate}","import React from 'react';\r\nimport Scoreboard from './parts/Scoreboard';\r\nimport Alert from './parts/Alert';\r\nimport {animate} from './parts/CanvasTools';\r\n\r\nimport styles from '../../static/css/canvas.module.css'\r\n\r\nexport default class Tictactoe extends React.Component {\r\n  constructor(props) {\r\n    super(props) \r\n    this.state = {\r\n\t\t\tcurrentPlayerTurn: props.gameInfo.currentPlayerTurn,\r\n      score: props.gameInfo.score,\r\n      alertValue: \"\", \r\n      lasttime: props.gameInfo.lasttime\r\n    }\r\n    this.currentBoard = props.gameInfo.currentBoard\r\n    this.paused = props.gameInfo.paused\r\n    props.players.every((player, index) => player.userId!== +localStorage.getItem('userId')?true:props.gameInfo.queue.every((queuePlayer, queueIndex) => {\r\n        if (queuePlayer===index) {\r\n        this.playerNumber = queueIndex\r\n        return false\r\n      } else return true\r\n    }))\r\n    this.canvas = React.createRef()\r\n  }\r\n  componentWillMount() {\r\n    this.emitterUnsubGame = this.props.emitter.sub('game', data => {\r\n      switch(data.type) {\r\n        case 'roundStarted': \r\n          this.setState({\r\n            currentPlayerTurn: data.currentPlayerTurn,\r\n            lasttime: data.lasttime,\r\n            alertValue: `Раунд начинается c хода ${this.props.players[this.props.gameInfo.queue[data.currentPlayerTurn]].userName}!`\r\n          })\r\n          this.paused = false\r\n          this.currentBoard = {}\r\n          this.clear()\r\n          break\r\n        case 'roundFinished': \r\n          this.paused = true\r\n          this.displayPoint(data.cell, data.x, data.y, true)\r\n          const newScore = this.state.score[data.cell][0]++\r\n          this.setState((prevState) => ({\r\n            currentPlayerTurn: data.nextPlayer, \r\n            score: {...prevState.score, ...newScore}, \r\n            lasttime: data.lasttime, \r\n            alertValue: `Раунд завершён! Победил ${this.props.players[this.props.gameInfo.queue[data.cell]].userName}`}))\r\n          break\r\n        case 'turn': \r\n          this.setState({currentPlayerTurn: data.nextPlayer, lasttime: data.lasttime, alertValue: `Ход игрока ${this.props.players[this.props.gameInfo.queue[data.nextPlayer]].userName}`})\r\n          this.displayPoint(data.cell, data.x, data.y, true)\r\n          break\r\n        case 'error': \r\n          this.displayPoint(data.cell, data.x, data.y)\r\n          break\r\n        case 'matchFinished': \r\n          this.setState({alertValue: `Матч завершён. Победил ${this.props.players[this.props.gameInfo.queue[data.currentPlayerTurn]].userName}`})\r\n          break\r\n        case 'nextPlayer': \r\n          if (this.state.currentPlayerTurn===this.playerNumber) this.setState({alertValue: 'Вы пропустили ход'})\r\n          else this.setState({alertValue: 'Оппонент пропустил ход'})\r\n          this.setState({currentPlayerTurn: data.nextPlayer, lasttime: data.lasttime})\r\n          break\r\n        default: break\r\n      }\r\n    })\r\n  }\r\n  componentDidMount() {\r\n      this.clear()\r\n      for (let cellNumber in this.currentBoard) {\r\n        this.displayPoint(this.currentBoard[cellNumber], cellNumber%this.props.gameInfo.boardSize, ~~(cellNumber/this.props.gameInfo.boardSize))\r\n      }\r\n  }\r\n  componentWillUnmount() {\r\n    this.emitterUnsubGame()\r\n  }\r\n\r\n  displayPoint = (value, x, y, animation=false) => {\r\n    const ctx = this.canvas.current.getContext('2d')\r\n    ctx.lineCap = \"round\"\r\n    ctx.lineWidth = 3\r\n    this.currentBoard[this.props.gameInfo.boardSize*y + x] = value\r\n    if (animation===true) {\r\n      switch (value) {\r\n        case 0: \r\n          animate(timestamp => {\r\n            ctx.clearRect(x*30+1, y*30+1, 28, 28)\r\n            ctx.fillStyle = `rgba(200,200,255, ${timestamp<1000?timestamp/1000:timestamp>2000?1-(timestamp-2000)/1000:1})`\r\n            ctx.fillRect(x*30+1, y*30+1, 28, 28)\r\n            ctx.fill()\r\n            ctx.strokeStyle = \"blue\"\r\n            ctx.beginPath()\r\n            const coordFirstLine = Math.floor((timestamp<300?timestamp:300)/16)\r\n            ctx.moveTo(x*30+6, y*30+6)\r\n            ctx.lineTo(x*30+6+coordFirstLine, y*30+6+coordFirstLine)\r\n            if (timestamp>300) {\r\n              const coordSecondLine = Math.floor((timestamp<600?timestamp-300:300)/16)\r\n              ctx.moveTo(x*30+24, y*30+6)\r\n              ctx.lineTo(x*30+24-coordSecondLine, y*30+6+coordSecondLine)\r\n            }\r\n            ctx.stroke()\r\n          }, 3000)\r\n        break\r\n        case 1: \r\n          animate(timestamp => {\r\n            ctx.clearRect(x*30+1, y*30+1, 28, 28)\r\n            ctx.fillStyle = `rgba(255,200,200, ${timestamp<1000?timestamp/1000:timestamp>2000?1-(timestamp-2000)/1000:1})`\r\n            ctx.fillRect(x*30+1, y*30+1, 28, 28)\r\n            ctx.fill()\r\n            ctx.strokeStyle = \"red\"\r\n            ctx.beginPath()\r\n            ctx.arc(x*30+15, y*30+15, 9, 0,-Math.PI*(timestamp<600?timestamp/300:2), true)\r\n            ctx.stroke()\r\n          }, 3000)\r\n        break\r\n        case 2: \r\n          animate(timestamp => {\r\n            ctx.clearRect(x*30+1, y*30+1, 28, 28)\r\n            ctx.fillStyle = `rgba(200,255,200, ${timestamp<1000?timestamp/1000:timestamp>2000?1-(timestamp-2000)/1000:1})`\r\n            ctx.fillRect(x*30+1, y*30+1, 28, 28)\r\n            ctx.fill()\r\n            ctx.fillStyle = \"green\"\r\n            ctx.beginPath()\r\n            ctx.arc(x*30+15, y*30+15, timestamp<600?timestamp/85:7, 0, Math.PI*2, true)\r\n            ctx.fill()\r\n          }, 3000)\r\n        break\r\n        default: break\r\n      }\r\n    } else {\r\n      switch (value) {\r\n        case 0: \r\n          ctx.strokeStyle = \"blue\"\r\n          ctx.beginPath()\r\n          ctx.moveTo(x*30+6, y*30+6)\r\n          ctx.lineTo(x*30+24, y*30+24)\r\n          ctx.moveTo(x*30+24, y*30+6)\r\n          ctx.lineTo(x*30+6, y*30+24)\r\n          ctx.stroke()\r\n        break\r\n        case 1: \r\n          ctx.strokeStyle = \"red\"\r\n          ctx.beginPath()\r\n          ctx.arc(x*30+15, y*30+15, 9, 0, Math.PI * 2, true)\r\n          ctx.stroke()\r\n        break\r\n        case 2: \r\n          ctx.fillStyle = \"green\"\r\n          ctx.beginPath()\r\n          ctx.arc(x*30+15, y*30+15, 7, 0, Math.PI * 2, true)\r\n          ctx.fill()\r\n        break\r\n        default: break\r\n      }\r\n    }\r\n  }\r\n  clear = () => {\r\n    const ctx = this.canvas.current.getContext('2d')\r\n    ctx.clearRect(0,0,(this.props.gameInfo.boardSize+1)*30, (this.props.gameInfo.boardSize+1)*30)\r\n    ctx.strokeStyle = '#000'\r\n    ctx.lineWidth = 1\r\n    ctx.beginPath();\r\n    for(let i = 0; i <= this.props.gameInfo.boardSize; i++) {\r\n      ctx.moveTo(i*30, 0)\r\n      ctx.lineTo(i*30, this.props.gameInfo.boardSize*30)\r\n    }\r\n    for(let i = 0; i <= this.props.gameInfo.boardSize; i++) {\r\n      ctx.moveTo(0, i*30)\r\n      ctx.lineTo(this.props.gameInfo.boardSize*30, i*30)\r\n    }\r\n    ctx.stroke()\r\n\r\n  }\r\n  actionTurn = (e) => {\r\n    if (this.paused||this.playerNumber!==this.state.currentPlayerTurn) return this.setState({alertValue: 'Сейчас очередь оппонента'})\r\n    const rect = this.canvas.current.getBoundingClientRect();\r\n    const x = ~~((e.clientX - rect.left)/30);\r\n    const y = ~~((e.clientY - rect.top)/30);\r\n    if (!this.currentBoard.hasOwnProperty(y*+this.props.gameInfo.boardSize+x)) {\r\n      this.props.emitter.emit('action', {x: x, y: y})\r\n    } else this.setState({alertValue: 'Ячейка занята'})\r\n  }\r\n  render() {\r\n      return (\r\n            <>\r\n              <Scoreboard displayCurrentPlayer={true}\r\n                paused={this.paused}\r\n                queue={this.props.gameInfo.queue} \r\n                players={this.props.players} \r\n                currentPlayerTurn={this.state.currentPlayerTurn} \r\n                playerNumber={this.playerNumber}\r\n                timeTurn={this.props.gameInfo.timeTurn} \r\n                lasttime={this.state.lasttime}\r\n                score={this.state.score}\r\n                scoreItemNames={['Счёт']} />\r\n\r\n              <Alert value={this.state.alertValue} />\r\n              \r\n              <div className={styles.canvas}>\r\n                <canvas ref={this.canvas} onClick={this.actionTurn} width={(+this.props.gameInfo.boardSize)*30+1} height={(+this.props.gameInfo.boardSize)*30+1}></canvas> \r\n              </div>\r\n            </>\r\n      )\r\n  }\r\n}\r\n"],"sourceRoot":""}