(this["webpackJsonplogic-games"]=this["webpackJsonplogic-games"]||[]).push([[5],{42:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var a=r(22),s=r(7),o=r(8),n=r(10),i=r(9),c=r(1),l=r(0),u=r.n(l),p=r(43),d=r.n(p),f=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(e){var o;return Object(s.a)(this,r),(o=t.call(this,e)).getPlayersList=function(){var e=[];if(void 0!==o.props.queue){var t,r=Object(a.a)(o.props.queue);try{for(r.s();!(t=r.n()).done;){var s=t.value;e.push(o.props.players[s])}}catch(n){r.e(n)}finally{r.f()}}else Array.prototype.push.apply(e,o.props.players);return e.map((function(e,t){return Object(c.jsxs)("div",{style:{color:e.connected?o.props.playerNumber===t?"rgb(255,165,0)":"#000":"rgb(150,150,150)"},children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:t+1}),Object(c.jsxs)("div",{children:["#",e.userId]}),Object(c.jsx)("div",{children:e.userName})]}),o.props.score[t].map((function(e){return Object(c.jsx)("div",{children:e})}))]})}))},o.state={timeleft:~~((e.timeTurn+e.lasttime-Date.now())/1e3)},o.playerTurnTimer=void 0,o}return Object(o.a)(r,[{key:"componentDidMount",value:function(){var e=this;this.props.displayCurrentPlayer&&(this.playerTurnTimer=setInterval((function(){return e.paused?null:e.setState({timeleft:~~((e.props.timeTurn+e.props.lasttime-Date.now())/1e3)})}),1e3))}},{key:"componentWillUnmount",value:function(){this.props.displayCurrentPlayer&&clearInterval(this.playerTurnTimer)}},{key:"render",value:function(){var e="rgb(".concat(255-this.state.timeleft/(this.props.timeTurn/1e3)*255,", ").concat(this.state.timeleft/(this.props.timeTurn/1e3)*200,", 0)");return Object(c.jsxs)("div",{className:d.a.score,children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:"\u0418\u0433\u0440\u043e\u043a\u0438"}),this.props.scoreItemNames.map((function(e){return Object(c.jsx)("div",{children:e})}))]}),this.props.displayCurrentPlayer?Object(c.jsxs)("div",{className:d.a.scoreCurrentPlayer,style:{color:e,top:25+42*this.props.currentPlayerTurn+"px",backgroundColor:e},children:[Object(c.jsx)("div",{children:this.state.timeleft}),Object(c.jsx)("div",{style:{"border-color":e}}),Object(c.jsx)("div",{style:{"border-color":e}})]}):Object(c.jsx)("div",{}),this.getPlayersList()]})}}]),r}(u.a.Component)},43:function(e,t,r){e.exports={score:"score_score__1Slqo",scoreCurrentPlayer:"score_scoreCurrentPlayer__36TAD"}},44:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var a=r(7),s=r(8),o=r(10),n=r(9),i=r(1),c=r(0),l=r.n(c),u=r(45),p=r.n(u),d=function(e){Object(o.a)(r,e);var t=Object(n.a)(r);function r(e){var s;return Object(a.a)(this,r),(s=t.call(this,e)).shouldComponentUpdate=function(){return s.alertDisplay=!0,void 0!==s.alertTimeoutDestroy&&clearTimeout(s.alertTimeoutDestroy),s.alertTimeoutDestroy=setTimeout((function(){s.alertDisplay=!1,s.alertTimeoutDestroy=void 0,s.forceUpdate()}),3e3),!0},s.alertHide=function(){clearTimeout(s.alertTimeoutDestroy),s.alertDisplay=!1,s.alertTimeoutDestroy=void 0,s.forceUpdate()},s.alertDisplay=!1,s.alertTimeoutDestroy=void 0,s}return Object(s.a)(r,[{key:"render",value:function(){return Object(i.jsx)("div",{className:"".concat(p.a.alert," ").concat(this.alertDisplay?p.a.alertDisplay:""),children:Object(i.jsx)("div",{onClick:this.alertHide,children:this.props.value})})}}]),r}(l.a.Component)},45:function(e,t,r){e.exports={alert:"alert_alert__285A5",alertDisplay:"alert_alertDisplay__3muLT"}},46:function(e,t,r){e.exports={canvas:"canvas_canvas__1xjwk"}},87:function(e,t,r){e.exports={button:"sapper_button__38G-W",highlite:"sapper_highlite__1xyk1"}},93:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return h}));var a=r(3),s=r(7),o=r(8),n=r(10),i=r(9),c=r(1),l=r(0),u=r.n(l),p=r(42),d=r(44),f=r(46),b=r.n(f),y=r(87),m=r.n(y),h=function(e){Object(n.a)(r,e);var t=Object(i.a)(r);function r(e){var a;return Object(s.a)(this,r),(a=t.call(this,e)).displayPoint=function(e,t,r){var s=a.canvas.current.getContext("2d");switch(s.font="24px serif",void 0!==r&&(a.board[a.props.gameInfo.boardSizeX*t+e]=r),r){case-2:s.fillStyle="red",s.fillRect(25*e,25*t,25,25);break;case-1:s.fillStyle="green",s.fillRect(25*e,25*t,25,25);break;case void 0:s.fillStyle="gray",s.fillRect(25*e,25*t,25,25),delete a.board[a.props.gameInfo.boardSizeX*t+e];break;case 0:s.fillStyle="white";break;case 1:s.fillStyle="blue";break;case 2:s.fillStyle="green";break;case 3:s.fillStyle="red";break;case 4:s.fillStyle="blue";break;case 5:s.fillStyle="brown";break;case 6:s.fillStyle="aqua";break;case 7:s.fillStyle="yellow";break;case 8:s.fillStyle="brown"}r>0&&s.fillText(r,25*e+7,25*t+20),0===r&&s.fillRect(25*e,25*t,25,25)},a.clear=function(){var e=a.canvas.current.getContext("2d");e.clearRect(0,0,25*(a.props.gameInfo.boardSizeX+1),25*(a.props.gameInfo.boardSizeY+1)),e.strokeStyle="#000",e.lineWidth=1,e.beginPath();for(var t=0;t<=a.props.gameInfo.boardSizeX;t++)e.moveTo(25*t,0),e.lineTo(25*t,25*a.props.gameInfo.boardSizeY);for(var r=0;r<=a.props.gameInfo.boardSizeY;r++)e.moveTo(0,25*r),e.lineTo(25*a.props.gameInfo.boardSizeX,25*r);e.stroke()},a.action=function(e,t){if(e.preventDefault(),!a.paused){var r=a.canvas.current.getBoundingClientRect(),s=~~((e.clientX-r.left)/25),o=~~((e.clientY-r.top)/25),n=o*a.props.gameInfo.boardSizeX+s;a.state.actionTypeDefuse&&"left"===t?a.board.hasOwnProperty(n)||a.props.emitter.emit("action",{x:s,y:o}):void 0!==a.board[n]&&-1!==a.board[n]||a.displayPoint(s,o,-1===a.board[n]?void 0:-1)}},a.state={score:e.gameInfo.score,alertValue:"",lasttime:e.gameInfo.lasttime,actionTypeDefuse:!0},a.canvas=u.a.createRef(),a}return Object(o.a)(r,[{key:"componentWillMount",value:function(){var e=this;this.paused=this.props.gameInfo.paused,this.board={},this.props.players.forEach((function(t,r){return t.userId===+localStorage.getItem("userId")?e.playerNumber=r:null})),this.emitterUnsubGame=this.props.emitter.sub("game",(function(t){switch(t.type){case"roundStarted":e.setState((function(e){var r=Object.assign(e.score);for(var a in e.score)r[a][1]=0;return{roundStarted:t.roundStarted,score:r,alertValue:"\u0420\u0430\u0443\u043d\u0434 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f!"}})),e.paused=!1,e.board={},e.clear();break;case"roundFinished":e.paused=!0;var r=e.state.score[t.currentPlayer][0]++;e.setState((function(s){return{score:Object(a.a)(Object(a.a)({},s.score),r),alertValue:"\u0420\u0430\u0443\u043d\u0434 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d! \u041f\u043e\u0431\u0435\u0434\u0438\u043b ".concat(e.props.players[t.currentPlayer].userName)}}));break;case"openedCells":for(var s in t.cells)e.displayPoint(s%e.props.gameInfo.boardSizeX,~~(s/e.props.gameInfo.boardSizeX),t.cells[s]);var o=e.state.score[e.playerNumber][1]+Object.keys(t.cells).length;e.setState((function(t){var r=Object.assign(t.score);return r[e.playerNumber][1]=o,{score:r}}));break;case"explode":e.displayPoint(t.x,t.y,-2),e.setState({alertValue:"".concat(e.props.players[t.currentPlayer].userName," \u0432\u0437\u043e\u0440\u0432\u0430\u043b\u0441\u044f")});break;case"progress":var n=e.state.score[t.currentPlayer][1]+t.countCells;e.setState((function(e){var r=Object.assign(e.score);return r[t.currentPlayer][1]=n,{score:r}}));break;case"error":break;case"matchFinished":e.setState({alertValue:"\u041c\u0430\u0442\u0447 \u0437\u0430\u0432\u0435\u0440\u0448\u0451\u043d. \u041f\u043e\u0431\u0435\u0434\u0438\u043b ".concat(e.props.players[t.currentPlayer].userName)})}}))}},{key:"componentDidMount",value:function(){this.clear();var e=localStorage.getItem("sapperData");if(""==!e){var t=JSON.parse(e),r=0;for(var a in this.state.score)r+=this.state.score[a][0];if(t.scoreSum===r)for(var s in t.board)this.displayPoint(s%this.props.gameInfo.boardSizeX,~~(s/this.props.gameInfo.boardSizeX),t.board[s])}}},{key:"componentWillUnmount",value:function(){var e=0;for(var t in this.state.score)e+=this.state.score[t][0];var r={scoreSum:e,board:this.board};localStorage.setItem("sapperData",JSON.stringify(r)),this.emitterUnsubGame()}},{key:"render",value:function(){var e=this;return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(p.a,{displayCurrentPlayer:!1,paused:this.paused,players:this.props.players,playerNumber:this.playerNumber,score:this.state.score,scoreItemNames:["\u0421\u0447\u0451\u0442","\u041f\u0440\u043e\u0433\u0440\u0435\u0441\u0441"]}),Object(c.jsx)(d.a,{value:this.state.alertValue}),Object(c.jsx)("div",{className:"".concat(m.a.button," ").concat(this.state.actionTypeDefuse?"":m.a.highlite),onClick:function(){return e.setState({actionTypeDefuse:!e.state.actionTypeDefuse})}}),Object(c.jsx)("div",{className:b.a.canvas,children:Object(c.jsx)("canvas",{ref:this.canvas,onClick:function(t){return e.action(t,"left")},onContextMenu:function(t){return e.action(t,"right")},width:25*+this.props.gameInfo.boardSizeX+1,height:25*+this.props.gameInfo.boardSizeY+1})})]})}}]),r}(u.a.Component)}}]);
//# sourceMappingURL=5.90a11064.chunk.js.map